<template>
  <template if:true={product}>
    <article class="slds-card" role="region" aria-labelledby="product-title" style="max-width: 700px; margin: auto;">
      <header class="slds-card__header slds-grid">
        <div class="slds-media slds-media_center slds-has-flexi-truncate">
          <div class="slds-media__body">
            <h2 id="product-title" class="slds-text-heading_medium slds-truncate" title={product.name}>
              {product.name}
            </h2>

          </div>
        </div>
      </header>
      
      <div class="slds-card__body slds-card__body_inner slds-grid slds-wrap">
        <!-- Left column: product details -->
        <div class="slds-col slds-size_1-of-2 slds-p-right_medium">
          <dl>
            <div class="slds-p-bottom_small">
              <dt class="slds-text-title_caps">Type</dt>
              <dd class="slds-text-body_regular">{product.recordType}</dd>
            </div>
            <div class="slds-p-bottom_small">
              <dt class="slds-text-title_caps">Country</dt>
              <dd class="slds-text-body_regular">{product.country}</dd>
            </div>
            <div class="slds-p-bottom_small">
              <dt class="slds-text-title_caps">Price</dt>
              <dd class="slds-text-body_regular">${product.price}</dd>
            </div>
            <div class="slds-p-bottom_small">
              <dt class="slds-text-title_caps">Description</dt>
              <dd class="slds-text-body_regular" style="white-space: normal;">{product.description}</dd>
            </div>
            <div class="slds-p-bottom_small">
              <dt class="slds-text-title_caps">Serial Number</dt>
              <dd class="slds-text-body_regular">{product.serialNumber}</dd>
            </div>
          </dl>
        </div>
        
        <!-- Right column: product image -->
        <div class="slds-col slds-size_1-of-2 slds-text-align_center">
          <template if:true={product.fullUrl}>
            <template if:true={isLoading}>
              <lightning-spinner alternative-text="Loading image" size="small"></lightning-spinner>
            </template>
            
            <img
              src={product.fullUrl}
              alt={product.name}
              class="slds-image slds-image_responsive"
              onload={handleImageLoad}
              loading="lazy" 
              decoding="async"
            />
            
<!--lazy:  Browser won’t load the image until it’s actually visible in the viewport. Saves 
decoding="async" → Lets the browser decode the image without blocking rendering, so the rest of the page stays responsive.

onload={handleImageLoad} → Event handler that fires only when the image has fully loaded, so you can stop the spinner.
-->
          </template>
          
<template if:false={product.fullUrl}>
    <div class="slds-text-body_small slds-text-color_weak slds-text-align_center" style="margin-top: 1rem; line-height: 1.4;">
        <p><strong>No image available</strong></p>
        <p style="margin: 0.5rem 0 0;">
            To display an image, open the product’s <em>Related</em> tab and upload a file starting with <strong>MAIN-</strong>. 
            The first file with <strong>MAIN-</strong> will show here automatically.
        </p>
    </div>
</template>


        </div>
      </div>
    </article>
  </template>
  
  <template if:true={error}>
    <aside class="slds-notify slds-notify_alert slds-theme_alert-texture slds-theme_error" role="alert">
      <span class="slds-assistive-text">Error</span>
      <h2>{error.message}</h2>
    </aside>
  </template>
</template>
